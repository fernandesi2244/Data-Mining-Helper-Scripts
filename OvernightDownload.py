"""
Downloads the files associated with the list of JSOC Requst IDs below.

Developed by Ian Fernandes and Yash Kadadi
"""

from sunpy.net import jsoc
from sunpy.net import Fido, attrs as a
import astropy.units as u
import os
import threading
import asyncio

client = jsoc.JSOCClient()

# data_path = '/mnt/horton_shared/PythonMag19_HMI_Data/TestingDuplicates'
data_path = '/mnt/horton_shared/PythonMag19_HMI_Data/TestTrainingData'

# Don't worry about this function; it was used for testing thread and asyncio "fixes"
def download(requestID):
        res = client.get_request(requestID, path=data_path)

# Everything from May 2010 to right before May 2014 + full request for Jul 15 2019 through Jun 1, 2020; Not valid IDs anymore
# allJSOCRequestIDs = ['JSOC_20200612_2762', 'JSOC_20200615_785', 'JSOC_20200615_794', 'JSOC_20200615_795', 'JSOC_20200615_801', 'JSOC_20200615_806', 'JSOC_20200615_819', 'JSOC_20200615_820', 'JSOC_20200615_842', 'JSOC_20200615_846', 'JSOC_20200615_851', 'JSOC_20200615_856', 'JSOC_20200615_930', 'JSOC_20200615_932', 'JSOC_20200615_934', 'JSOC_20200615_803', 'JSOC_20200615_809', 'JSOC_20200615_813', 'JSOC_20200615_830', 'JSOC_20200615_839', 'JSOC_20200615_843', 'JSOC_20200615_853', 'JSOC_20200615_861', 'JSOC_20200615_862', 'JSOC_20200615_867', 'JSOC_20200615_880', 'JSOC_20200615_884', 'JSOC_20200615_890', 'JSOC_20200615_896', 'JSOC_20200615_898', 'JSOC_20200615_901', 'JSOC_20200615_903', 'JSOC_20200615_908', 'JSOC_20200615_910', 'JSOC_20200615_912', 'JSOC_20200615_913', 'JSOC_20200615_916', 'JSOC_20200615_919', 'JSOC_20200615_920', 'JSOC_20200615_921', 'JSOC_20200615_922', 'JSOC_20200615_926', 'JSOC_20200615_931', 'JSOC_20200615_933', 'JSOC_20200615_947', 'JSOC_20200615_949', 'JSOC_20200615_959', 'JSOC_20200615_975', 'JSOC_20200615_987', 'JSOC_20200615_995', 'JSOC_20200615_1217', 'JSOC_20200615_1230', 'JSOC_20200615_1243', 'JSOC_20200615_1269', 'JSOC_20200615_1286', 'JSOC_20200615_937', 'JSOC_20200615_940', 'JSOC_20200615_944', 'JSOC_20200615_948', 'JSOC_20200615_950', 'JSOC_20200615_952', 'JSOC_20200615_956', 'JSOC_20200615_968', 'JSOC_20200615_979', 'JSOC_20200615_990', 'JSOC_20200616_3864', 'JSOC_20200616_3881', 'JSOC_20200616_3345', 'JSOC_20200616_3358', 'JSOC_20200616_3317', 'JSOC_20200616_3331', 'JSOC_20200616_3156', 'JSOC_20200616_3172', 'JSOC_20200616_3286', 'JSOC_20200616_3303', 'JSOC_20200616_3038', 'JSOC_20200616_3128', 'JSOC_20200616_2957', 'JSOC_20200616_2979', 'JSOC_20200615_1364', 'JSOC_20200616_469', 'JSOC_20200615_1314', 'JSOC_20200615_1341', 'JSOC_20200616_3376', 'JSOC_20200616_3397', 'JSOC_20200616_3407', 'JSOC_20200616_3436', 'JSOC_20200616_3448', 'JSOC_20200616_3464', 'JSOC_20200616_3475', 'JSOC_20200616_3609', 'JSOC_20200616_3627', 'JSOC_20200616_3714', 'JSOC_20200616_3736', 'JSOC_20200616_3893', 'JSOC_20200616_3908', 'JSOC_20200616_3937', 'JSOC_20200616_3956', 'JSOC_20200616_3975', 'JSOC_20200616_4007', 'JSOC_20200616_4031', 'JSOC_20200616_4050', 'JSOC_20200616_4075', 'JSOC_20200616_4087', 'JSOC_20200616_4104', 'JSOC_20200616_4127', 'JSOC_20200616_4177', 'JSOC_20200616_4193', 'JSOC_20200616_4209', 'JSOC_20200616_4235', 'JSOC_20200616_4259', 'JSOC_20200616_4276', 'JSOC_20200616_4286', 'JSOC_20200616_4303', 'JSOC_20200616_4354', 'JSOC_20200616_4362', 'JSOC_20200616_4375', 'JSOC_20200616_4380', 'JSOC_20200616_4429', 'JSOC_20200616_4439', 'JSOC_20200616_4450', 'JSOC_20200616_4461', 'JSOC_20200616_4467', 'JSOC_20200616_4483', 'JSOC_20200616_4498', 'JSOC_20200616_4509', 'JSOC_20200616_4515', 'JSOC_20200617_073', 'JSOC_20200617_085', 'JSOC_20200617_098', 'JSOC_20200616_3748', 'JSOC_20200616_3758', 'JSOC_20200616_3775', 'JSOC_20200616_3793', 'JSOC_20200616_3811', 'JSOC_20200616_3831', 'JSOC_20200616_3857', 'JSOC_20200616_3885', 'JSOC_20200616_3907', 'JSOC_20200616_3933', 'JSOC_20200616_3976']

# May 2014 down (Some IDs still valid?)
# allJSOCRequestIDs = ['JSOC_20200617_2151', 'JSOC_20200617_2159', 'JSOC_20200617_2176', 'JSOC_20200617_2197', 'JSOC_20200617_2246', 'JSOC_20200617_2253', 'JSOC_20200617_2277', 'JSOC_20200617_2315', 'JSOC_20200617_2326', 'JSOC_20200617_2339', 'JSOC_20200617_2352', 'JSOC_20200617_2379', 'JSOC_20200617_2404', 'JSOC_20200617_2412', 'JSOC_20200617_2445', 'JSOC_20200617_2488', 'JSOC_20200617_2514', 'JSOC_20200617_2523', 'JSOC_20200617_2547', 'JSOC_20200617_2566', 'JSOC_20200617_2602', 'JSOC_20200617_2613', 'JSOC_20200617_2627', 'JSOC_20200617_2645', 'JSOC_20200617_2662', 'JSOC_20200617_2671', 'JSOC_20200617_2694', 'JSOC_20200617_2716', 'JSOC_20200617_2742', 'JSOC_20200617_2776', 'JSOC_20200617_2807', 'JSOC_20200617_148', 'JSOC_20200617_161', 'JSOC_20200617_238', 'JSOC_20200617_250', 'JSOC_20200617_261', 'JSOC_20200617_277', 'JSOC_20200617_296', 'JSOC_20200617_306', 'JSOC_20200617_312', 'JSOC_20200617_322', 'JSOC_20200617_336', 'JSOC_20200617_353', 'JSOC_20200617_372', 'JSOC_20200617_386', 'JSOC_20200617_391', 'JSOC_20200617_406', 'JSOC_20200617_423', 'JSOC_20200617_427', 'JSOC_20200617_440', 'JSOC_20200617_454', 'JSOC_20200617_459', 'JSOC_20200617_466', 'JSOC_20200617_475', 'JSOC_20200617_484', 'JSOC_20200617_491', 'JSOC_20200617_502', 'JSOC_20200617_516', 'JSOC_20200617_523', 'JSOC_20200617_531', 'JSOC_20200617_546', 'JSOC_20200617_551', 'JSOC_20200617_557', 'JSOC_20200617_569', 'JSOC_20200617_577', 'JSOC_20200617_585', 'JSOC_20200617_598', 'JSOC_20200617_614', 'JSOC_20200617_623', 'JSOC_20200617_628', 'JSOC_20200617_634', 'JSOC_20200617_643', 'JSOC_20200617_654', 'JSOC_20200617_663', 'JSOC_20200617_674', 'JSOC_20200617_692', 'JSOC_20200617_2181', 'JSOC_20200617_2188', 'JSOC_20200617_2222', 'JSOC_20200617_2232', 'JSOC_20200617_2267', 'JSOC_20200617_2296', 'JSOC_20200617_2391', 'JSOC_20200617_2422', 'JSOC_20200617_2436', 'JSOC_20200617_2457', 'JSOC_20200617_2470', 'JSOC_20200617_2499', 'JSOC_20200617_2540', 'JSOC_20200617_2557', 'JSOC_20200617_2580', 'JSOC_20200617_2591', 'JSOC_20200617_2638', 'JSOC_20200617_2657', 'JSOC_20200617_2677', 'JSOC_20200617_2686', 'JSOC_20200617_2701', 'JSOC_20200617_2706', 'JSOC_20200617_2727', 'JSOC_20200617_2732', 'JSOC_20200617_2752', 'JSOC_20200617_2757', 'JSOC_20200617_2770', 'JSOC_20200617_2788', 'JSOC_20200617_2801', 'JSOC_20200617_2843', 'JSOC_20200617_2851', 'JSOC_20200617_2868', 'JSOC_20200617_2890', 'JSOC_20200617_2899', 'JSOC_20200617_2924', 'JSOC_20200617_2938', 'JSOC_20200617_2949', 'JSOC_20200617_2972', 'JSOC_20200617_2980', 'JSOC_20200617_2995', 'JSOC_20200617_3002', 'JSOC_20200617_3014', 'JSOC_20200617_2844', 'JSOC_20200617_2863', 'JSOC_20200617_2874', 'JSOC_20200617_2897', 'JSOC_20200617_2923', 'JSOC_20200617_2963', 'JSOC_20200617_2969']

# This one had 215 successes and 24 failures
# allJSOCRequestIDs = ['JSOC_20200625_883', 'JSOC_20200625_885', 'JSOC_20200625_886', 'JSOC_20200625_893', 'JSOC_20200625_897', 'JSOC_20200625_898', 'JSOC_20200626_007', 'JSOC_20200626_010', 'JSOC_20200626_015', 'JSOC_20200626_017', 'JSOC_20200626_025', 'JSOC_20200626_030', 'JSOC_20200625_848', 'JSOC_20200625_858', 'JSOC_20200625_865', 'JSOC_20200625_867', 'JSOC_20200625_869', 'JSOC_20200625_874', 'JSOC_20200625_887', 'JSOC_20200625_892', 'JSOC_20200625_896', 'JSOC_20200625_902', 'JSOC_20200625_907', 'JSOC_20200625_850', 'JSOC_20200625_855', 'JSOC_20200625_864', 'JSOC_20200625_866', 'JSOC_20200625_868', 'JSOC_20200625_871', 'JSOC_20200625_888', 'JSOC_20200625_890', 'JSOC_20200625_899', 'JSOC_20200625_903', 'JSOC_20200625_908', 'JSOC_20200625_909', 'JSOC_20200625_910', 'JSOC_20200625_911', 'JSOC_20200625_913', 'JSOC_20200625_915', 'JSOC_20200625_916', 'JSOC_20200625_918', 'JSOC_20200625_919', 'JSOC_20200625_922', 'JSOC_20200625_923', 'JSOC_20200626_003', 'JSOC_20200626_005', 'JSOC_20200626_011', 'JSOC_20200626_020', 'JSOC_20200626_033', 'JSOC_20200626_036', 'JSOC_20200626_038', 'JSOC_20200626_042', 'JSOC_20200626_050', 'JSOC_20200626_051', 'JSOC_20200626_053', 'JSOC_20200626_056', 'JSOC_20200626_059', 'JSOC_20200626_060', 'JSOC_20200626_062', 'JSOC_20200626_063', 'JSOC_20200626_066', 'JSOC_20200626_067', 'JSOC_20200626_068', 'JSOC_20200626_071', 'JSOC_20200626_073', 'JSOC_20200625_600', 'JSOC_20200625_603', 'JSOC_20200625_610', 'JSOC_20200625_611', 'JSOC_20200625_616', 'JSOC_20200625_619', 'JSOC_20200625_624', 'JSOC_20200625_626', 'JSOC_20200625_628', 'JSOC_20200625_632', 'JSOC_20200625_634', 'JSOC_20200625_636', 'JSOC_20200625_642', 'JSOC_20200625_644', 'JSOC_20200625_646', 'JSOC_20200625_648', 'JSOC_20200625_650', 'JSOC_20200625_652', 'JSOC_20200625_655', 'JSOC_20200625_660', 'JSOC_20200625_664', 'JSOC_20200625_666', 'JSOC_20200625_670', 'JSOC_20200625_674', 'JSOC_20200625_676', 'JSOC_20200625_685', 'JSOC_20200625_691', 'JSOC_20200625_697', 'JSOC_20200625_707', 'JSOC_20200625_716', 'JSOC_20200625_722', 'JSOC_20200625_736', 'JSOC_20200625_746', 'JSOC_20200625_749', 'JSOC_20200625_752', 'JSOC_20200625_757', 'JSOC_20200625_761', 'JSOC_20200625_764', 'JSOC_20200625_771', 'JSOC_20200625_775', 'JSOC_20200625_778', 'JSOC_20200625_786', 'JSOC_20200625_794', 'JSOC_20200625_799', 'JSOC_20200625_805', 'JSOC_20200625_815', 'JSOC_20200625_538', 'JSOC_20200625_546', 'JSOC_20200625_549', 'JSOC_20200625_556', 'JSOC_20200625_559', 'JSOC_20200625_562', 'JSOC_20200625_570', 'JSOC_20200625_579', 'JSOC_20200625_583', 'JSOC_20200625_586', 'JSOC_20200625_589', 'JSOC_20200625_593', 'JSOC_20200625_595', 'JSOC_20200625_598', 'JSOC_20200625_602', 'JSOC_20200625_608', 'JSOC_20200625_612', 'JSOC_20200625_617', 'JSOC_20200625_620', 'JSOC_20200625_625', 'JSOC_20200625_627', 'JSOC_20200625_630', 'JSOC_20200625_633', 'JSOC_20200625_635', 'JSOC_20200625_638', 'JSOC_20200625_643', 'JSOC_20200625_649', 'JSOC_20200625_651', 'JSOC_20200625_656', 'JSOC_20200625_662', 'JSOC_20200625_663', 'JSOC_20200625_665', 'JSOC_20200625_669', 'JSOC_20200625_673', 'JSOC_20200625_675', 'JSOC_20200625_679', 'JSOC_20200625_681', 'JSOC_20200625_686', 'JSOC_20200625_692', 'JSOC_20200625_696', 'JSOC_20200625_703', 'JSOC_20200625_710', 'JSOC_20200625_715', 'JSOC_20200625_725', 'JSOC_20200625_732', 'JSOC_20200625_485', 'JSOC_20200625_490', 'JSOC_20200625_497', 'JSOC_20200625_502', 'JSOC_20200625_504', 'JSOC_20200625_505', 'JSOC_20200625_509', 'JSOC_20200625_511', 'JSOC_20200625_512', 'JSOC_20200625_515', 'JSOC_20200625_519', 'JSOC_20200625_528', 'JSOC_20200625_531', 'JSOC_20200625_532', 'JSOC_20200625_537', 'JSOC_20200625_430', 'JSOC_20200625_437', 'JSOC_20200625_442', 'JSOC_20200625_445', 'JSOC_20200625_446', 'JSOC_20200625_449', 'JSOC_20200625_455', 'JSOC_20200625_461', 'JSOC_20200625_467', 'JSOC_20200625_472', 'JSOC_20200625_474', 'JSOC_20200625_475', 'JSOC_20200625_478', 'JSOC_20200625_481', 'JSOC_20200625_439', 'JSOC_20200625_469', 'JSOC_20200625_484', 'JSOC_20200625_487', 'JSOC_20200625_513', 'JSOC_20200625_522', 'JSOC_20200625_523', 'JSOC_20200625_525', 'JSOC_20200625_542', 'JSOC_20200625_551', 'JSOC_20200625_558', 'JSOC_20200625_565', 'JSOC_20200625_569', 'JSOC_20200625_572', 'JSOC_20200625_582', 'JSOC_20200625_585', 'JSOC_20200625_588', 'JSOC_20200625_592', 'JSOC_20200625_680', 'JSOC_20200625_682', 'JSOC_20200625_694', 'JSOC_20200625_700', 'JSOC_20200625_705', 'JSOC_20200625_711', 'JSOC_20200625_727', 'JSOC_20200625_739', 'JSOC_20200625_743', 'JSOC_20200625_747', 'JSOC_20200625_754', 'JSOC_20200625_759']

# These are the 24 failures; let's try to run them again.
# allJSOCRequestIDs = ['JSOC_20200625_762', 'JSOC_20200625_767', 'JSOC_20200625_773', 'JSOC_20200625_777', 'JSOC_20200625_782', 'JSOC_20200625_788', 'JSOC_20200625_790', 'JSOC_20200625_796', 'JSOC_20200625_800', 'JSOC_20200625_809', 'JSOC_20200625_822', 'JSOC_20200625_824', 'JSOC_20200625_830', 'JSOC_20200625_842', 'JSOC_20200625_843', 'JSOC_20200625_846', 'JSOC_20200625_856', 'JSOC_20200625_860', 'JSOC_20200625_544', 'JSOC_20200625_547', 'JSOC_20200625_555', 'JSOC_20200625_561', 'JSOC_20200625_563', 'JSOC_20200625_578']

# 2010 May onwards
# allJSOCRequestIDs = ['JSOC_20200625_848', 'JSOC_20200625_858', 'JSOC_20200625_865', 'JSOC_20200625_867', 'JSOC_20200625_869', 'JSOC_20200625_874', 'JSOC_20200625_887', 'JSOC_20200625_892', 'JSOC_20200625_896', 'JSOC_20200625_902', 'JSOC_20200625_907']

# May 2010
# allJSOCRequestIDs = ['JSOC_20200706_112']

# April + May of 2010 (for test to send to JSOC)
# allJSOCRequestIDs = ['JSOC_20200708_796', 'JSOC_20200708_951']

# NRT Downloads (be aware that many years and months didn't work)
allJSOCRequestIDs = ['JSOC_20200725_1013', 'JSOC_20200725_1018', 'JSOC_20200725_1022', 'JSOC_20200725_1036', 'JSOC_20200725_1043', 'JSOC_20200725_1054', 'JSOC_20200725_1065', 'JSOC_20200725_1068', 'JSOC_20200725_1085', 'JSOC_20200725_1087', 'JSOC_20200725_1091', 'JSOC_20200725_1114', 'JSOC_20200725_1117', 'JSOC_20200725_1120', 'JSOC_20200725_1125', 'JSOC_20200725_1128', 'JSOC_20200725_1133', 'JSOC_20200725_1136', 'JSOC_20200725_1138', 'JSOC_20200725_1140', 'JSOC_20200725_1142', 'JSOC_20200725_1145', 'JSOC_20200725_1149', 'JSOC_20200725_1160', 'JSOC_20200725_1165', 'JSOC_20200725_1166', 'JSOC_20200725_1171', 'JSOC_20200725_1174', 'JSOC_20200725_1177', 'JSOC_20200725_1388', 'JSOC_20200725_1394', 'JSOC_20200725_1402', 'JSOC_20200725_1409', 'JSOC_20200725_1416', 'JSOC_20200725_1425', 'JSOC_20200725_1433', 'JSOC_20200725_1440', 'JSOC_20200725_1447', 'JSOC_20200725_1456', 'JSOC_20200725_1466', 'JSOC_20200725_1481', 'JSOC_20200725_1490', 'JSOC_20200726_098', 'JSOC_20200726_107', 'JSOC_20200726_115', 'JSOC_20200726_124', 'JSOC_20200726_136', 'JSOC_20200726_143', 'JSOC_20200726_153', 'JSOC_20200726_162', 'JSOC_20200726_1527', 'JSOC_20200726_1546', 'JSOC_20200727_130', 'JSOC_20200727_148', 'JSOC_20200727_432', 'JSOC_20200727_574']

allJSOCRequestIDs = allJSOCRequestIDs[:]

res = client.get_request(allJSOCRequestIDs, path=data_path, max_splits=0)

'''
worked = 0

success_file = open('/mnt/horton_shared/PythonMag19_HMI_Data/successIDs.txt', 'a')
failure_file = open('/mnt/horton_shared/PythonMag19_HMI_Data/failureIDs.txt', 'a')
success_file.write('-'*100+'\n')
failure_file.write('-'*100+'\n')

for requestID in allJSOCRequestIDs:
        os.system('echo moving to next dataset ' + requestID)
        try:
                # thread = threading.Thread(target=download, args=(requestID,))
                # thread.start()
                # thread.join()

                # loop = asyncio.get_event_loop()
                # loop.run_until_complete(download(requestID))

                res = client.get_request(requestID, path=data_path, max_conn=5)
                success_file.write(str(requestID)+'\n')

                # Use flush and fsync to make sure we can see updates live
                success_file.flush()
                os.fsync(success_file)
                os.system('echo The following ID worked: '+str(requestID))
                worked += 1
        except:
                failure_file.write(str(requestID)+'\n')
                failure_file.flush()
                os.fsync(failure_file)
                os.system("echo The following ID was not so nice: "+ str(requestID))

success_file.close()
failure_file.close()

os.system("echo Worked: "+str(worked))
os.system("echo Failed: "+str(len(allJSOCRequestIDs)-worked))
os.system("echo Downloads finished. Check the specified directory.")
'''